                                                1 Introduction

   This Technical Note provides background information and commentary to the OpenLCB Train Search Protocol
   Standard. This document is not intended to be read standalone, but in parallel to the matching Standard.

1.1 Background

  1.1.1 Relation to Traction Protocol

   The OpenLCB Network is a peer-to-peer network where Nodes connected to the network can communicate with
   each other using the OpenLCB Network Protocols. These protocols are organized around the different OSI
   layers, and to achieve an end-to-end use-case a multitude of protocols are typically used, from
   different layers1, or in a complementary manner2.

   Some of these protocols are broadcast, meaning that all Nodes receive the messages of the interaction;
   other protocols are addressed, meaning the interaction takes place between two specific Nodes, and other
   Nodes do not receive the messages of the interaction. In order for an addressed interaction to take
   place, the initiating Node needs to know the Node ID of the target Node. This generally requires some
   broadcast protocol using which the initiating Node can discover the possible target Nodes, and present
   these on a user interface to the user to select.

   Considering the interaction of a user using an OpenLCB-connected Throttle to communicate to an
   OpenLCB-connected Train, or an OpenLCB-connected Command Station, we have two protocols that are part of
   this interaction:

     * The Traction Protocol defines the addressed interactions related to driving a train, such as setting
       speed and direction, or operating functions. It takes place between one Throttle and one or more
       Train Node(s) that are controlled.

     * The Train Search Protocol is a broadcast protocol that specifies interactions needed for the
       Throttle to identify the Node ID of the Train Node that the user intends to drive.

  1.1.2 Relation to Legacy Track Protocols

   Trains may or may not be equipped with the necessary technology to directly participate in the OpenLCB
   Network. For now and the foreseeable future, an overwhelming majority of digitally controlled trains
   will be using a mobile decoder that operates using an existing standard or proprietary method of
   transmitting commands to the mobile decoder through the track, such as the NMRA® DCC® protocol suite.

   In such a setting, there is a centralized component called Command Station which is responsible for
   generating the track protocol signal. This device has to receive commands from the Throttles, and
   translate them to remote control the mobile decoders built into the trains rolling on the track. The
   Command Station is then responsible for participating on the OpenLCB Network and representing the remote
   trains. The Traction Protocol requires each train to be a separate OpenLCB Node with its own Node ID,
   therefore the one Command Station device will be operating a number of Virtual Nodes, one per actively
   controlled train. All of these Virtual Train Nodes participate in the Train Search Protocol so that
   Throttles can discover, find and operate the trains connected to the track.

   An important question then becomes: how does the Command Station know when the user intends to address a
   new train on the track that does not yet have a matching Virtual Train Node. The Train Search Protocol
   addresses this use-case as well.

  1.1.3 Relation to other Search and Discovery Protocols

   Note that the existence of Train Search Protocol does not exclude other methods and standards, including
   some not yet developed, for the same or similar purposes. There are also possibilities of using less
   capable existing Standards to achieve similar results (covering some but not all use-cases), albeit at a
   higher cost for the Throttle Node in terms of the necessary resources (above all RAM) and higher number
   of network messages to send and keep track of.

   Some of these options are described in the Alternatives Considered section below (TODO: replace with
   reference).

1.2 Served Use Cases

     * The User is holding a Throttle connected to the OpenLCB Network. The Throttle has a numeric keypad
       and no screen. The user types in the four digit cab number they see on the locomotive and presses
       the Enter key. The Throttle uses the Train Search Protocol to find the matching OpenLCB Node. Then
       the throttle uses the Traction Protocol to connect to that Train Node, and the user is able to drive
       the train.
       Note that this use-case presents the same way if the train itself has a radio-equipped decoder and
       is directly participating on the OpenLCB network; and also if the train has a DCC decoder and
       represented by a Command Station on the OpenLCB Network.

     * The user owns a locomotive with road number 474 014 with a legacy track protocol decoder. The user
       does not remember what address is assigned to the decoder, but there is a Roster (locomotive
       database) in the Command Station, which has a record of the track address, and the name “Re 474 014”
       is assigned to this record. The user has a Throttle with a numeric keypad and a screen, and types in
       474 on the keypad. The Throttle uses the Train Search Protocol to look for matching entries on the
       network. The Command Station searches through the Roster, instantiates the matching Virtual Nodes,
       provides the list of matching Node IDs to the Throttle. The Throttle queries the user-visible names
       of those Nodes using the Simple Node Information Protocol and presents a list to the user to select
       from. The user selects “Re 474 014”, and starts driving the train.

     * The user purchased a new locomotive which came with a Marklin-Motorola format mobile decoder with
       address 72. The user puts it onto the track, types in 72 on the throttle, selects the
       Marklin-Motorola track protocol using option keys, and presses Enter. The user is in control of the
       locomotive.

     * A friend comes over and brings a DCC-equipped locomotive with them. They warn that the locomotive
       has a very old decoder. The user enters the address on the Throttle, selects the DCC-14-speed-step
       protocol using option keys, and presses Enter. The user is in control of the locomotive.

1.3 Unserved Use Cases

     * The Train Search protocol is not a generic search protocol. It is not possible to search for any
       other entity than a Node3. While the concept could be used for searching for other types of nodes,
       the specific allocation shall only be used for searching for Train Nodes. This is necessary in order
       to ensure that Throttles that use this allocation properly function on the network.

     * The search results are only Node IDs. If additional information beyond the Node ID is needed (such
       as user-visible name), the Throttle has to use other protocols (such as the Simple Node
       Identification Protocol) to query that information.

     * Only digits are supported in the search query. The maximum length of the query is 6 digits. Longer
       and alphanumeric search queries are not supported.

     * A Command Station can only receive a signal using the Train Search Protocol when the user wants a
       new Virtual Train Node to be created. The Train Search Protocol does not support giving a signal to
       the Command Station on when to delete a Virtual Train Node.

                                        2 Annotations to the Standard

2.1 Introduction

   Note that this section of the Standard is informative, not normative.

   The Train Search Protocol is built on top of the Event Transport Protocol, which operates using generic
   OpenLCB messages. This means that the Train Search Protocol can operate on any supported OpenLCB
   transport layer, including CAN-bus and TCP. This allows both wired and wireless Throttles to operate
   using the Train Search Protocol.

2.2 Intended Use

   Note that this section of the Standard is informative, not normative.

2.3 Reference and Context

   Lorem ipsum dolor sit amet, consectetur adipiscing elit.4 Fusce ornare mattis justo vitae imperdiet.

2.4 Message Formats

   Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.

2.5 States

   Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.

2.6 Interactions

   Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.

                                          3 Alternatives considered

    

    

                                               4 Section Title

4.1 Subsection Title

  4.1.1 Sub-subsection Title

   Praesent gravida pulvinar vehicula. Vivamus eu nisl eget sem rutrum suscipit id a magna. Integer id ante
   odio.

     * Lorem ipsum dolor sit amet, consectetur adipiscing elit.

     * Sed consectetur, ipsum et egestas accumsan, felis erat ornare mauris, sit amet suscipit ante orci
       sed massa.

                                               5 Section Title

   Quisque sollicitudin tempor bibendum. Donec consectetur condimentum sollicitudin. Sed dignissim velit id
   felis lacinia at eleifend nisi laoreet. Vivamus tristique porta ornare. Vivamus feugiat dolor id lectus
   aliquet luctus.

   Quisque sollicitudin tempor bibendum. Donec consectetur condimentum sollicitudin. Sed dignissim velit id
   felis lacinia at eleifend nisi laoreet. Vivamus tristique porta ornare. Vivamus feugiat dolor id lectus
   aliquet luctus.

   Quisque sollicitudin tempor bibendum. Donec consectetur condimentum sollicitudin. Sed dignissim velit id
   felis lacinia at eleifend nisi laoreet. Vivamus tristique porta ornare. Vivamus feugiat dolor id lectus
   aliquet luctus.

   Quisque sollicitudin tempor bibendum. Donec consectetur condimentum sollicitudin. Sed dignissim velit id
   felis lacinia at eleifend nisi laoreet. Vivamus tristique porta ornare. Vivamus feugiat dolor id lectus
   aliquet luctus.

   Quisque sollicitudin tempor bibendum. Donec consectetur condimentum sollicitudin. Sed dignissim velit id
   felis lacinia at eleifend nisi laoreet. Vivamus tristique porta ornare. Vivamus feugiat dolor id lectus
   aliquet luctus.

    

   Table of Contents

   1 Introduction

   1.1 Background

   1.1.1 Relation to Traction Protocol

   1.1.2 Relation to Legacy Track Protocols

   1.1.3 Relation to other Search and Discovery Protocols

   1.2 Served Use Cases

   1.3 Unserved Use Cases

   2 Annotations to the Standard

   2.1 Introduction

   2.2 Intended Use

   2.3 Reference and Context

   2.4 Message Formats

   2.5 States

   2.6 Interactions

   3 Alternatives considered

   4 Section Title

   4.1 Subsection Title

   4.1.1 Sub-subsection Title

   5 Section Title

    

     ----------------------------------------------------------------------------------------------------

   1 Example: The Memory Configuration Protocol is using the Datagram Protocol as a supporting layer.

   2 Example: for end users to configure an OpenLCB Node, the Memory Configuration Protocol is expanded
   with the Configuration Description Information protocol to describe what configuration settings are
   available at which memory offsets.

   3 For example it is not possible to search for an Event.

   4 See the “Common Information” OpenLCB Technical Note for detailed conventions on bit and byte
   numbering. Briefly, the least significant bit of a field is numbered with zero in OpenLCB descriptions,
   but note that other technologies may use other conventions.
